---
import { getCollection, getEntry } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";

const team = await getCollection("team");
const posts = await getCollection("posts");
---

<BaseLayout title="Home">
  <h1>Homepage</h1>
  <div>
    <h2>Team</h2>
    <ul>
      {team.map((t) => <li>{t.data.name}</li>)}
    </ul>
  </div>
  <div>
    <h2>Posts</h2>
    <ul>
      { 
        posts.map(async (p) => {
          const authorDetails = await getEntry("team", p.data.author.id);
          const roleDetails = await getEntry("role", authorDetails.data.role.id);
          return (
            <li>
              <figure>
                <Image src={p.data.cover} alt={p.data.coverAlt} format="avif" width="500" />
                <figcaption>
                  <a href={`/posts/${p.slug}`}>{p.data.title}</a> by {authorDetails.data.name} ({roleDetails.data.name})
                </figcaption>
              </figure>
            </li>
          )
        })
      }
    </ul>
  </div>
</BaseLayout>