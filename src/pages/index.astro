---
import { getCollection, getEntry } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";

const team = await getCollection("team");
const posts = await getCollection("posts", ({ data }) => !data.isDraft);
---

<BaseLayout title="Home">
  <h1>Homepage</h1>
  <div>
    <h2>Team</h2>
    <ul>
      {
        team.map((t) => (
          <li>
            <p>{t.data.name}</p>
            <p>{t.data.role.id}</p>
          </li>
        ))
      }
    </ul>
  </div>
  <div>
    <h2>Posts</h2>
    <ul>
      {
        posts.map(async (p) => {
          const authorDetails = await getEntry("team", p.data.author.id);
          return <li>
            <a href={p.slug}>Read Post {p.data.title} by {authorDetails.data.name}</a>
          </li>
        })
      }
    </ul>
  </div>
</BaseLayout>