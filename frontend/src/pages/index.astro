---
import TestimonialCard from "@/components/Testimonials";
import BaseLayout from "@/layouts/BaseLayout.astro";
import "@/styles/globals.css";
import type { APIResponseCollection } from "@/types/types";
//import { getEntries, getEntry } from "astro:content";

const BASE_URL = "http://127.0.0.1:1338"

async function getData() {
  const response = await fetch(`${BASE_URL}/api/pages?populate[0]=primary_heading&populate[1]=blocks&populate[2]=blocks.heading&populate[3]=blocks.testimonials&populate[4]=blocks.testimonials.image`);
  if (!response.ok) {
    throw new Error("Failed to fetch data");
  }
  return await response.json();
}

const { data } = (await getData() as APIResponseCollection<"api::page.page">);
//console.log("ðŸš€ ~ data:", data)

const blockData = data[0].blocks;
console.log("ðŸš€ ~ blockData:", blockData);
const examplet = blockData[0].testimonials[0];
console.log("ðŸš€ ~ examplet:", examplet)

const strapiData = {
  heading: blockData[0].heading,
  testimonials: blockData[0].testimonials.map((t: any) => {
    return {
      ...t,
      image: `${BASE_URL}${t.image.formats.thumbnail.url}`,
    }
  })
}
console.log("ðŸš€ ~ strapiData:", strapiData)



// const testimonialSection = await getEntry("keystatic", "testimonialSection");

// const testimonials = await getEntries(testimonialSection.data.testimonials);

// const testimonialData = {
//   heading: testimonialSection.data.heading,
//   testimonials: testimonials.map(({ data }) => {
//     return {
//       ...data,
//       image: data.image.src,
//     };
//   }),
// };

// export type TestimonialSectionType = typeof testimonialData;
---

<BaseLayout title="Homepage">
  <TestimonialCard data={strapiData} />
</BaseLayout>
